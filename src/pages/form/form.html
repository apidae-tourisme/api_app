<ion-header>
  <ion-navbar color="lighter" hideBackButton="true">
    <ion-buttons left>
      <button ion-button icon-only color="link" (click)="dismissForm()" large>
        <ion-icon name="arrow-back" large></ion-icon>
      </button>
    </ion-buttons>
    <ion-title text-center>{{node.id ? 'Modifier la ' : 'Créer une '}}graine</ion-title>
    <ion-buttons right>
      <button ion-button icon-only color="link" (click)="submitForm()" large>
        <ion-icon name="checkmark-circle-outline" large></ion-icon>
      </button>
    </ion-buttons>
  </ion-navbar>
</ion-header>

<ion-content id="seed_form">
  <div padding *ngIf="!node.id">
    <button ion-button block large ngClass="bg_{{node.category}}" (click)="seedTypes()">
      <i class="{{'ion-md-custom-' + node.category}}"></i>&nbsp;{{node.typeLabel()}}
    </button>
  </div>
  <ion-list>
    <ion-item *ngIf="node.category != 'person'">
      <ion-label stacked>Nom</ion-label>
      <ion-input type="text" [(ngModel)]="node.label"></ion-input>
    </ion-item>
    <ion-item *ngIf="node.category == 'person'">
      <ion-label stacked>Prénom</ion-label>
      <ion-input type="text" [(ngModel)]="node.firstName"></ion-input>
    </ion-item>
    <ion-item *ngIf="node.category == 'person'">
      <ion-label stacked>Nom</ion-label>
      <ion-input type="text" [(ngModel)]="node.lastName"></ion-input>
    </ion-item>
    <ion-item>
      <ion-label stacked>Description</ion-label>
      <ion-textarea rows="4" [(ngModel)]="node.description"></ion-textarea>
    </ion-item>
    <ion-item *ngIf="dataService.userSeed.id == node.ownerId || node.scope == 'public'" no-lines class="label_only">
      <ion-label stacked>Visibilité</ion-label>
    </ion-item>
    <ion-item *ngIf="dataService.userSeed.id == node.ownerId || node.scope == 'public'">
      <ion-label>{{scopeLabel()}}</ion-label>
      <button ion-button item-right large icon-only [color]="scopeColor()" (click)="toggleScope()">
        <ion-icon [name]="scopeIcon()"></ion-icon>
      </button>
    </ion-item>
    <ion-item no-lines class="label_only">
      <ion-label stacked>Visuel</ion-label>
    </ion-item>
    <ion-item>
      <ion-avatar item-left class="bg_seed {{node.category}}">
        <img *ngIf="node.picture" src="{{node.picture}}"/>
        <div *ngIf="!node.picture" class="bg_seed {{node.category}}" text-center><i ngClass="ion-md-custom-{{node.code}}"></i></div>
      </ion-avatar>
      <button ion-button item-right large icon-only color="link" (click)="editAvatar()">
        <ion-icon name="create"></ion-icon>
      </button>
      <button ion-button item-right large icon-only color="danger" (click)="clearAvatar()">
        <ion-icon name="close"></ion-icon>
      </button>
    </ion-item>
    <ion-item *ngIf="node.category != 'person'">
      <ion-label stacked>Début</ion-label>
      <ion-datetime displayFormat="DD/MM/YYYY" pickerFormat="DD/MM/YYYY" min="2015" max="2020" cancelText="Supprimer"
                    doneText="OK" [(ngModel)]="node.startDate" (ionCancel)="clearStartDate()"></ion-datetime>
    </ion-item>
    <ion-item *ngIf="node.category != 'person'">
      <ion-label stacked>Fin</ion-label>
      <ion-datetime displayFormat="DD/MM/YYYY" pickerFormat="DD/MM/YYYY" min="2015" max="2020" cancelText="Supprimer"
                    doneText="OK" [(ngModel)]="node.endDate" (ionCancel)="clearEndDate()"></ion-datetime>
    </ion-item>
    <ion-item>
      <ion-label stacked>Téléphone fixe</ion-label>
      <ion-input type="tel" [(ngModel)]="node.telephone"></ion-input>
    </ion-item>
    <ion-item>
      <ion-label stacked>Téléphone mobile</ion-label>
      <ion-input type="tel" [(ngModel)]="node.mobilePhone"></ion-input>
    </ion-item>
    <ion-item no-lines class="label_only">
      <ion-label stacked>Graines liées</ion-label>
    </ion-item>
    <ion-item *ngFor="let seed of node.seeds; let i = index;" no-lines>
      <ion-avatar item-left class="bg_seed {{seed.category}}">
        <img *ngIf="seed.picture" src="{{seed.picture}}"/>
        <div *ngIf="!seed.picture" text-center><i class="ion-md-custom-{{seed.category}}"></i></div>
      </ion-avatar>
      <h2>{{seed.label}}</h2>
      <button ion-button item-right large icon-only color="danger" (click)="node.seeds.splice(index, 1)"><ion-icon name="close"></ion-icon></button>
    </ion-item>
    <ion-item>
      <button ion-button block large ngClass="bg_concept" (click)="addSeed()">Lier une graine</button>
    </ion-item>
    <ion-item no-lines class="label_only">
      <ion-label stacked>Liens</ion-label>
    </ion-item>
    <ion-item *ngFor="let url of node.urls; let i = index;" no-lines>
      <ion-label stacked>Lien {{i + 1}}</ion-label>
      <ion-input type="text" [(ngModel)]="url.value"></ion-input>
      <button ion-button item-right large icon-only color="danger" (click)="node.urls.splice(index, 1)"><ion-icon name="close"></ion-icon></button>
    </ion-item>
    <ion-item>
      <button ion-button block large ngClass="bg_concept" (click)="addUrl()">Ajouter un lien</button>
    </ion-item>
  </ion-list>
</ion-content>
